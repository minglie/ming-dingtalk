M=require("ming_node")axios=require("axios")appkey='dingh8atns3doji34fr1'appsecret='nM83RNJwzXf6Z6rHAkY0kGzI7ooVj2YDG61X0-QMoSg6Kj9dIDreWXbrP-146haF'agentId=223159395;nonceStr="abcdefg";corpId="ding43b3a65d280ba98835c2f4657eb6378f"userid='manager6712'access_token='caa0f610c5833b81ae694d319c40ad36'function  get_access_token(appkey,appsecret){    return new Promise(function(resolve){        M.getHttps(            "https://oapi.dingtalk.com/gettoken",            function (date) {                access_token=JSON.parse(date).access_token                M.setAttribute("access_tokeen",access_token);                console.log("1->",access_token)                resolve(access_token);            },            {                appkey,                appsecret            }        )    });}//获取部门列表function department_list(access_token){    return new Promise(function(resolve){        M.getHttps(            "https://oapi.dingtalk.com/department/list",            function (date) {                resolve(date);            },            {                access_token            }        )    });}//获取部门用户function user_simplelist(access_token,department_id){    return new Promise(function(resolve){        M.getHttps(            "https://oapi.dingtalk.com/user/simplelist",            function (date) {                resolve(date);            },            {                access_token,                department_id            }        )    });}//获取用户详情function user_get(access_token,userid){    return new Promise(function(resolve){        M.getHttps(            "https://oapi.dingtalk.com/user/get",            function (date) {                resolve(date);            },            {                access_token,                userid            }        )    });}//发送工作通知消息function corpconversation_asyncsend_v2(access_token){    return new Promise(function(resolve){        axios.post('https://oapi.dingtalk.com/topapi/message/corpconversation/asyncsend_v2?access_token=' + access_token, {            'agent_id': agentId,            'userid_list':"manager6712",            //'dept_id_list': "71482134", //人员            'msg': {"msgtype":"text","text":{"content":"000只有一个人收到"}}        }).then((resp) => {resolve(resp.data)})    });}//查询工作通知消息的发送进度function corpconversation_getsendprogress(access_token){    return new Promise(function(resolve){        axios.post('https://oapi.dingtalk.com/topapi/message/corpconversation/getsendprogress?access_token=' + access_token, {            'agent_id': agentId,            'task_id': 25955453499        }).then((resp) => {resolve(resp.data)})    });}//查询工作通知消息的发送结果function corpconversation_getsendresult(access_token){    return new Promise(function(resolve){        axios.post('https://oapi.dingtalk.com/topapi/message/corpconversation/getsendresult?access_token=' + access_token, {            'agent_id': agentId,            'task_id': 25955453499        }).then((resp) => {resolve(resp.data)})    });}async function main() {    if(0){        a= await  get_access_token(appkey,appsecret)        console.log(a);    }    if(0){        r=  await department_list(access_token)        console.log(r)    }    if(0){        r=  await user_simplelist(access_token,71482134)        console.log(r)    }    if(0){        r=await  user_get(access_token,"180966056020854312")        console.log(r)    }    if(1){        r= await corpconversation_asyncsend_v2(access_token)        console.log(r)    }    if(0){        r= await corpconversation_getsendprogress(access_token)        console.log(r)    }    if(0){        r= await corpconversation_getsendresult(access_token)        console.log(r)    }}main();